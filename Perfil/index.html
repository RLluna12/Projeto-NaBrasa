<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>
</head>
<body>
    <h1>Perfil do Usuário</h1>
    <form id="profileForm">
        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
        </div>
        <div>
            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" required>
        </div>
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div>
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone" required>
        </div>
        <div>
            <label for="senha">Senha:</label>
            <input type="password" id="senha" name="senha" required>
        </div>
        <div>
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" name="cpf" required>
        </div>
        <div>
            <input type="submit" value="Salvar Alterações">
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Função para carregar os dados do usuário no formulário
            function loadProfile() {
                // Fazer requisição AJAX para buscar os dados do usuário pelo email
                const userEmail = "email_do_usuario"; // Substitua com o email do usuário
                fetch(`http://localhost:3004/Churrasqueiro?Email=${userEmail}`)
                    .then(response => response.json())
                    .then(data => {
                        const user = data[0]; // Considerando que apenas um usuário será retornado
                        document.getElementById('nome').value = user.Nome;
                        document.getElementById('endereco').value = user.Endereco;
                        document.getElementById('email').value = user.Email;
                        document.getElementById('telefone').value = user.Telefone;
                        document.getElementById('senha').value = user.Senha;
                        document.getElementById('cpf').value = user.CPF;
                    })
                    .catch(error => console.error('Erro ao carregar perfil:', error));
            }

            // Chamar a função para carregar o perfil quando a página for carregada
            loadProfile();

            // Adicionar evento de envio do formulário
            document.getElementById('profileForm').addEventListener('submit', function (event) {
                event.preventDefault(); // Impede o envio padrão do formulário

                // Obter os dados do formulário
                const formData = new FormData(this);

                // Fazer requisição AJAX para atualizar os dados do usuário
                fetch(`http://localhost:3004/churrasqueiro/${formData.get('email')}`, {
                    method: 'PUT',
                    body: JSON.stringify({
                        Nome: formData.get('nome'),
                        Endereco: formData.get('endereco'),
                        Email: formData.get('email'),
                        Telefone: formData.get('telefone'),
                        Senha: formData.get('senha'),
                        CPF: formData.get('cpf')
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => {
                        if (response.ok) {
                            alert('Perfil atualizado com sucesso!');
                            // Recarregar o perfil após a atualização
                            loadProfile();
                        } else {
                            throw new Error('Erro ao atualizar perfil');
                        }
                    })
                    .catch(error => console.error('Erro ao atualizar perfil:', error));
            });
        });
    </script>
</body>
</html>
